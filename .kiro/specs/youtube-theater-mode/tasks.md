# 実装計画

- [x] 1. プロジェクト構造とマニフェストファイルの作成

  - Chrome 拡張機能の基本ディレクトリ構造を作成
  - manifest.json ファイルを実装し、必要な権限と Content Script を定義
  - 基本的なファイル（content.js, background.js, popup.html）の空のテンプレートを作成
  - _要件: 1.1, 2.1_

- [x] 2. YouTube 要素検出システムの実装
- [x] 2.1 要素セレクター定数とユーティリティ関数の作成

  - YouTube 動画プレーヤーと周辺要素を特定するセレクター定数を定義
  - 要素検出のためのヘルパー関数を実装（フォールバック機能付き）
  - 要素検出機能の単体テストを作成
  - _要件: 1.1, 1.2, 5.1_

- [x] 2.2 動画プレーヤー検出機能の実装

  - 動画プレーヤー要素を確実に検出する関数を実装
  - ページ読み込み完了を待つ非同期処理を実装
  - 動画プレーヤー検出のテストケースを作成
  - _要件: 1.2, 5.1_

- [x] 3. シアターモード切り替え機能の実装
- [x] 3.1 基本的なオーバーレイ機能の実装

  - CSS オーバーレイスタイルを定義（theater-mode.css）
  - オーバーレイ要素の動的生成と削除機能を実装
  - オーバーレイ適用/除去の基本機能をテスト
  - _要件: 1.2, 1.3, 2.2_

- [x] 3.2 シアターモード状態管理の実装

  - シアターモードの有効/無効状態を管理するクラスを実装
  - 状態変更時のイベント処理を実装
  - 状態管理機能の単体テストを作成
  - _要件: 1.4, 2.3_

- [x] 4. ユーザーインターフェース要素の実装
- [x] 4.1 シアターモード切り替えボタンの実装

  - YouTube ページにシアターモードボタンを動的に追加
  - ボタンクリック時の切り替え処理を実装
  - ボタンの状態表示（有効/無効）を実装
  - ボタン機能のテストケースを作成
  - _要件: 1.1, 1.4, 2.3_

- [x] 4.2 ボタンスタイリングと配置の実装

  - ボタンの CSS スタイルを実装（YouTube のデザインに調和）
  - ボタンの適切な配置位置を決定し実装
  - レスポンシブ対応のスタイリングを実装
  - _要件: 1.1, 1.4_

- [x] 5. キーボードショートカット機能の実装
- [x] 5.1 キーボードイベントハンドラーの実装

  - Ctrl+Shift+T ショートカットの検出機能を実装
  - YouTube ページでのみ動作する条件分岐を実装
  - 既存の YouTube ショートカットとの競合回避を実装
  - キーボードショートカットのテストケースを作成
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 5.2 ショートカットとボタン状態の連携

  - キーボードショートカット実行時のボタン状態更新を実装
  - ショートカットとボタンクリックの統一処理を実装
  - 連携機能のテストケースを作成
  - _要件: 3.3_

- [x] 6. 設定管理システムの実装
- [x] 6.1 Chrome Storage API を使用した設定保存機能

  - 設定データ構造の定義と初期化を実装
  - Chrome Storage API を使用した設定保存/読み込み機能を実装
  - 設定データのバリデーション機能を実装
  - 設定管理機能の単体テストを作成
  - _要件: 4.3_

- [x] 6.2 透明度設定機能の実装

  - オーバーレイ透明度の動的変更機能を実装
  - 透明度設定の即座反映機能を実装
  - デフォルト透明度（70%）の設定を実装
  - 透明度変更機能のテストケースを作成
  - _要件: 4.1, 4.2, 4.4_

- [x] 7. ポップアップ UI の実装
- [x] 7.1 設定ポップアップの基本構造

  - popup.html の基本レイアウトを実装
  - 透明度調整スライダーの実装
  - 現在の設定状態表示機能を実装
  - _要件: 4.1, 4.2_

- [x] 7.2 ポップアップと Content Script の通信

  - ポップアップから Content Script へのメッセージ送信を実装
  - 設定変更の即座反映機能を実装
  - 通信エラーハンドリングを実装
  - ポップアップ通信機能のテストケースを作成
  - _要件: 4.2_

- [x] 8. Background Service Worker の実装
- [x] 8.1 拡張機能初期化処理の実装

  - 拡張機能インストール時の初期設定を実装
  - Content Script との通信管理を実装
  - エラーハンドリングとログ機能を実装
  - Background Service Worker のテストケースを作成
  - _要件: 2.4_

- [x] 8.2 タブ管理と状態同期の実装

  - 複数タブでの状態管理を実装
  - タブ切り替え時の状態保持機能を実装
  - タブ管理機能のテストケースを作成
  - _要件: 2.4_

- [x] 9. 動画プレーヤー操作保護機能の実装
- [x] 9.1 動画コントロール要素の保護

  - 動画プレーヤーコントロールをオーバーレイから除外する機能を実装
  - 再生/一時停止、音量、シークバーの正常動作を確保
  - 動画コントロール保護のテストケースを作成
  - _要件: 5.1, 5.2_

- [x] 9.2 YouTube ショートカットキーの保護

  - スペースキー、矢印キーなどの標準ショートカットの動作確保を実装
  - 全画面表示切り替えの正常動作を確保
  - ショートカットキー保護のテストケースを作成
  - _要件: 5.4_

- [x] 10. エラーハンドリングと堅牢性の実装
- [x] 10.1 YouTube レイアウト変更対応

  - 要素検出失敗時のリトライ機能を実装
  - 複数セレクターパターンによるフォールバック機能を実装
  - レイアウト変更対応のテストケースを作成
  - _要件: 1.2, 5.1_

- [x] 10.2 設定読み込みエラー対応

  - 設定読み込み失敗時のデフォルト値使用を実装
  - 設定データ破損時の復旧機能を実装
  - エラーハンドリングのテストケースを作成
  - _要件: 4.3_

- [x] 11. パフォーマンス最適化の実装
- [x] 11.1 イベントリスナー最適化

  - デバウンス処理による性能向上を実装
  - 不要なイベントリスナーの削除機能を実装
  - パフォーマンス最適化のテストケースを作成
  - _要件: 3.1, 5.4_

- [x] 11.2 CSS アニメーション最適化

  - ハードウェアアクセラレーション対応の CSS を実装
  - スムーズなトランジション効果を実装
  - アニメーション性能のテストケースを作成
  - _要件: 1.2, 2.2_

- [x] 12. 統合テストと最終調整
- [x] 12.1 全機能統合テストの実装

  - 全ての機能が連携して正常動作することを確認するテストを作成
  - 異なる YouTube 動画ページでの動作確認テストを実装
  - エッジケース（ネットワーク遅延、複数タブなど）のテストを作成
  - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 5.1, 5.2, 5.3, 5.4_

- [x] 12.2 ユーザビリティとアクセシビリティの最終確認
  - スクリーンリーダー対応の確認と修正を実装
  - キーボードナビゲーションの確認と修正を実装
  - 色覚異常対応の確認と修正を実装
  - アクセシビリティテストケースを作成
  - _要件: 1.1, 3.1, 4.1_
