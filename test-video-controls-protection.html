<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Theater Mode - å‹•ç”»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä¿è­·ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #c00;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .test-description {
            margin-bottom: 15px;
            color: #666;
        }
        .test-controls {
            margin-bottom: 15px;
        }
        button {
            background-color: #c00;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #a00;
        }
        .results {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .mock-player {
            width: 640px;
            height: 360px;
            background-color: #000;
            position: relative;
            margin: 20px 0;
        }
        .mock-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            padding: 0 10px;
        }
        .mock-button {
            width: 32px;
            height: 32px;
            background-color: transparent;
            border: none;
            color: white;
            margin-right: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mock-progress {
            flex-grow: 1;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            position: relative;
            cursor: pointer;
        }
        .mock-progress-filled {
            position: absolute;
            height: 100%;
            background-color: #f00;
            width: 50%;
        }
        .mock-volume {
            width: 100px;
            display: flex;
            align-items: center;
        }
        .mock-volume-slider {
            flex-grow: 1;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            position: relative;
            cursor: pointer;
        }
        .mock-volume-level {
            position: absolute;
            height: 100%;
            background-color: white;
            width: 70%;
        }
        .theater-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9998;
            pointer-events: none;
        }
        .theater-mode-video-area {
            position: relative;
            z-index: 9999;
            pointer-events: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #eee;
        }
        .log-entry.success {
            color: green;
        }
        .log-entry.error {
            color: red;
        }
        .log-entry.info {
            color: blue;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube Theater Mode - å‹•ç”»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä¿è­·ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <div class="test-title">ãƒ†ã‚¹ãƒˆ 1: å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ä¿è­·</div>
            <div class="test-description">
                ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹æ™‚ã«å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒæ­£å¸¸ã«æ“ä½œã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
                ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒé©ç”¨ã•ã‚Œã¦ã‚‚ã€å†ç”Ÿ/ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ã€éŸ³é‡èª¿æ•´ã€ã‚·ãƒ¼ã‚¯ãƒãƒ¼ãªã©ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
            </div>
            
            <div class="mock-player" id="mockPlayer">
                <div class="mock-controls" id="mockControls">
                    <button class="mock-button" id="playButton">â–¶</button>
                    <div class="mock-progress" id="progressBar">
                        <div class="mock-progress-filled" id="progressFilled"></div>
                    </div>
                    <div class="mock-volume">
                        <button class="mock-button" id="volumeButton">ğŸ”Š</button>
                        <div class="mock-volume-slider" id="volumeSlider">
                            <div class="mock-volume-level" id="volumeLevel"></div>
                        </div>
                    </div>
                    <button class="mock-button" id="fullscreenButton">â›¶</button>
                </div>
            </div>
            
            <div class="test-controls">
                <button id="toggleTheaterMode">ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</button>
                <button id="testControls">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button id="clearLog">ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
            </div>
            
            <div class="results" id="testResults"></div>
        </div>
    </div>

    <!-- ãƒ¢ãƒƒã‚¯YouTubeã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ -->
    <script>
        const YouTubeSelectors = {
            videoPlayer: [
                "#mockPlayer",
                ".mock-player"
            ],
            overlayElements: [
                ".container",
                "body"
            ],
            protectedElements: [
                "#mockPlayer",
                ".mock-player",
                ".mock-controls",
                ".mock-button",
                ".mock-progress",
                ".mock-volume",
                ".mock-volume-slider"
            ]
        };
    </script>
    
    <!-- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="test-video-controls-protection.js"></script>
    <script src="run-controls-tests.js"></script>
    
    <!-- åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ãƒ†ã‚¹ãƒˆã‚’åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            const testButton = document.getElementById('testControls');
            const toggleButton = document.getElementById('toggleTheaterMode');
            const clearLogButton = document.getElementById('clearLog');
            
            if (testButton) {
                testButton.addEventListener('click', () => {
                    // ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                    const tester = new VideoControlsProtectionTest();
                    tester.runTests();
                    
                    // è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚‚å®Ÿè¡Œ
                    if (window.runControlsTests) {
                        window.runControlsTests();
                    }
                });
            }
            
            // ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®è¨­å®š
            if (toggleButton) {
                toggleButton.addEventListener('click', () => {
                    const isActive = toggleButton.textContent.includes('ç„¡åŠ¹åŒ–');
                    
                    if (isActive) {
                        // ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
                        removeOverlay();
                        toggleButton.textContent = 'ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–';
                        log('ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã«ãªã‚Šã¾ã—ãŸ', 'success');
                    } else {
                        // ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
                        applyOverlay();
                        toggleButton.textContent = 'ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ç„¡åŠ¹åŒ–';
                        log('ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ', 'success');
                    }
                });
            }
            
            // ãƒ­ã‚°ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¨­å®š
            if (clearLogButton) {
                clearLogButton.addEventListener('click', () => {
                    document.getElementById('testResults').innerHTML = '';
                });
            }
            
            // ãƒ¢ãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            setupMockControls();
        });
        
        // ãƒ¢ãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        function setupMockControls() {
            // å†ç”Ÿ/ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³
            document.getElementById('playButton').addEventListener('click', () => {
                const button = document.getElementById('playButton');
                if (button.textContent === 'â–¶') {
                    button.textContent = 'â¸';
                    log('å†ç”Ÿãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'success');
                } else {
                    button.textContent = 'â–¶';
                    log('ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'success');
                }
            });
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            document.getElementById('progressBar').addEventListener('click', (e) => {
                const progressBar = document.getElementById('progressBar');
                const progressFilled = document.getElementById('progressFilled');
                
                const rect = progressBar.getBoundingClientRect();
                const position = (e.clientX - rect.left) / rect.width;
                
                progressFilled.style.width = `${position * 100}%`;
                log(`ã‚·ãƒ¼ã‚¯ãƒãƒ¼ãŒ ${Math.round(position * 100)}% ã®ä½ç½®ã«è¨­å®šã•ã‚Œã¾ã—ãŸ`, 'success');
            });
            
            // éŸ³é‡ãƒœã‚¿ãƒ³
            document.getElementById('volumeButton').addEventListener('click', () => {
                const button = document.getElementById('volumeButton');
                if (button.textContent === 'ğŸ”Š') {
                    button.textContent = 'ğŸ”‡';
                    document.getElementById('volumeLevel').style.width = '0%';
                    log('ãƒŸãƒ¥ãƒ¼ãƒˆãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ', 'success');
                } else {
                    button.textContent = 'ğŸ”Š';
                    document.getElementById('volumeLevel').style.width = '70%';
                    log('ãƒŸãƒ¥ãƒ¼ãƒˆãŒè§£é™¤ã•ã‚Œã¾ã—ãŸ', 'success');
                }
            });
            
            // éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            document.getElementById('volumeSlider').addEventListener('click', (e) => {
                const volumeSlider = document.getElementById('volumeSlider');
                const volumeLevel = document.getElementById('volumeLevel');
                
                const rect = volumeSlider.getBoundingClientRect();
                const position = (e.clientX - rect.left) / rect.width;
                
                volumeLevel.style.width = `${position * 100}%`;
                log(`éŸ³é‡ãŒ ${Math.round(position * 100)}% ã«è¨­å®šã•ã‚Œã¾ã—ãŸ`, 'success');
                
                // éŸ³é‡ãŒ0ã®å ´åˆã¯ãƒŸãƒ¥ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã«å¤‰æ›´
                if (position === 0) {
                    document.getElementById('volumeButton').textContent = 'ğŸ”‡';
                } else {
                    document.getElementById('volumeButton').textContent = 'ğŸ”Š';
                }
            });
            
            // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³
            document.getElementById('fullscreenButton').addEventListener('click', () => {
                log('ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'success');
            });
        }
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é©ç”¨
        function applyOverlay() {
            // æ—¢å­˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
            removeOverlay();
            
            try {
                log('ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã™...', 'info');
                
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¦ç´ ã‚’ä½œæˆ
                const overlayElement = document.createElement('div');
                overlayElement.className = 'theater-mode-overlay';
                overlayElement.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                overlayElement.id = 'theaterOverlay';
                
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ãƒšãƒ¼ã‚¸ã«è¿½åŠ 
                document.body.appendChild(overlayElement);
                
                // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚’ä¿è­·ï¼ˆz-indexã‚’ä¸Šã’ã‚‹ï¼‰
                const videoPlayer = document.getElementById('mockPlayer');
                if (videoPlayer) {
                    videoPlayer.classList.add('theater-mode-video-area');
                    log('å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‹ã‚‰ä¿è­·ã•ã‚Œã¾ã—ãŸ', 'success');
                } else {
                    log('å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
                
                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ã‚’ä¿è­·
                protectPlayerControls();
            } catch (error) {
                log(`ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é©ç”¨ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
                removeOverlay();
            }
        }
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é™¤å»
        function removeOverlay() {
            try {
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¦ç´ ã‚’å‰Šé™¤
                const overlayElement = document.getElementById('theaterOverlay');
                if (overlayElement && overlayElement.parentNode) {
                    overlayElement.parentNode.removeChild(overlayElement);
                }
                
                // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®ä¿è­·ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                const videoPlayer = document.getElementById('mockPlayer');
                if (videoPlayer) {
                    videoPlayer.classList.remove('theater-mode-video-area');
                }
                
                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ã®ä¿è­·ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                const controls = document.getElementById('mockControls');
                if (controls) {
                    controls.classList.remove('theater-mode-video-area');
                    
                    const controlElements = controls.querySelectorAll('button, .mock-progress, .mock-volume-slider');
                    controlElements.forEach(element => {
                        element.classList.remove('theater-mode-video-area');
                        element.style.pointerEvents = '';
                    });
                }
                
                log('ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ', 'info');
            } catch (error) {
                log(`ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
            }
        }
        
        // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä¿è­·
        function protectPlayerControls() {
            try {
                // ä¿è­·å¯¾è±¡ã®è¦ç´ ã‚’å–å¾—
                const controls = document.getElementById('mockControls');
                if (!controls) {
                    log('ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                    return;
                }
                
                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ã«ä¿è­·ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                controls.classList.add('theater-mode-video-area');
                
                // å€‹åˆ¥ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ã‚‚ä¿è­·
                const controlElements = controls.querySelectorAll('button, .mock-progress, .mock-volume-slider');
                controlElements.forEach(element => {
                    element.classList.add('theater-mode-video-area');
                    // pointer-eventsã‚’autoã«è¨­å®šã—ã¦æ“ä½œå¯èƒ½ã«ã™ã‚‹
                    element.style.pointerEvents = 'auto';
                });
                
                log('å‹•ç”»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¦ç´ ãŒä¿è­·ã•ã‚Œã¾ã—ãŸ', 'success');
            } catch (error) {
                log(`ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä¿è­·ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
            }
        }
        
        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®æ“ä½œæ€§ã‚’ãƒ†ã‚¹ãƒˆ
        function testControlsInteraction() {
            log('ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ“ä½œãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            // å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            setTimeout(() => {
                // å†ç”Ÿãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ
                document.getElementById('playButton').click();
                
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ
                setTimeout(() => {
                    const progressBar = document.getElementById('progressBar');
                    const rect = progressBar.getBoundingClientRect();
                    const clickEvent = new MouseEvent('click', {
                        clientX: rect.left + rect.width * 0.75,
                        clientY: rect.top + rect.height / 2,
                        bubbles: true
                    });
                    progressBar.dispatchEvent(clickEvent);
                    
                    // å°‘ã—å¾…ã£ã¦ã‹ã‚‰éŸ³é‡ã®ãƒ†ã‚¹ãƒˆ
                    setTimeout(() => {
                        const volumeSlider = document.getElementById('volumeSlider');
                        const volumeRect = volumeSlider.getBoundingClientRect();
                        const volumeClickEvent = new MouseEvent('click', {
                            clientX: volumeRect.left + volumeRect.width * 0.3,
                            clientY: volumeRect.top + volumeRect.height / 2,
                            bubbles: true
                        });
                        volumeSlider.dispatchEvent(volumeClickEvent);
                        
                        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ
                        setTimeout(() => {
                            document.getElementById('fullscreenButton').click();
                            
                            log('ã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
        
        // ãƒ­ã‚°å‡ºåŠ›
        function log(message, type = 'info') {
            const resultsElement = document.getElementById('testResults');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsElement.appendChild(logEntry);
            resultsElement.scrollTop = resultsElement.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
    </script>
</body>
</html>