<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DOMOptimizer Tests - YouTube Theater Mode</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f8f9fa;
        color: #333;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
      }

      .header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1em;
      }

      .info-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .info-section h3 {
        margin-top: 0;
        color: #28a745;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
      }

      .test-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .feature-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #28a745;
      }

      .feature-card h4 {
        margin: 0 0 10px 0;
        color: #495057;
      }

      .feature-card ul {
        margin: 0;
        padding-left: 20px;
      }

      .feature-card li {
        margin-bottom: 5px;
        color: #6c757d;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-loading {
        background-color: #ffc107;
        animation: pulse 1.5s infinite;
      }

      .status-ready {
        background-color: #28a745;
      }

      .status-error {
        background-color: #dc3545;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        color: #6c757d;
        font-size: 0.9em;
      }

      .loading-message {
        text-align: center;
        padding: 20px;
        font-size: 1.1em;
        color: #28a745;
      }

      code {
        background-color: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        color: #e83e8c;
      }

      .performance-note {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 6px;
        padding: 15px;
        margin: 15px 0;
      }

      .performance-note h4 {
        margin: 0 0 10px 0;
        color: #856404;
      }

      .performance-note p {
        margin: 0;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>‚ö° DOMOptimizer Tests</h1>
      <p>
        YouTube Theater Mode Extension - DOM Operations Performance Component
      </p>
    </div>

    <div class="info-section">
      <h3>üìã Test Overview</h3>
      <p>
        This test suite validates the <code>DOMOptimizer</code> class, which
        provides efficient DOM manipulation through batching, virtual DOM
        concepts, and performance monitoring for the YouTube Theater Mode
        extension.
      </p>

      <div class="test-features">
        <div class="feature-card">
          <h4>üîß Basic Operations</h4>
          <ul>
            <li>Class manipulation (add/remove/toggle)</li>
            <li>Style property updates</li>
            <li>Attribute management</li>
            <li>Element insertion/removal</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>‚ö° Performance Optimization</h4>
          <ul>
            <li>Batch processing of DOM operations</li>
            <li>Operation deduplication</li>
            <li>Priority-based scheduling</li>
            <li>Frame-based execution timing</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üéØ Advanced Features</h4>
          <ul>
            <li>Virtual DOM state tracking</li>
            <li>Element state caching</li>
            <li>Conditional operation execution</li>
            <li>Immediate vs deferred execution</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üìä Monitoring & Analytics</h4>
          <ul>
            <li>Performance metrics collection</li>
            <li>Rendering time measurement</li>
            <li>Operation count tracking</li>
            <li>Memory usage monitoring</li>
          </ul>
        </div>
      </div>

      <div class="performance-note">
        <h4>üöÄ Performance Benefits</h4>
        <p>
          The DOMOptimizer reduces layout thrashing and improves rendering
          performance by batching DOM operations, eliminating redundant updates,
          and scheduling operations during optimal browser frames. This is
          especially important for the theater mode overlay system which
          frequently updates element styles and classes.
        </p>
      </div>
    </div>

    <div class="info-section">
      <h3>üöÄ Test Execution</h3>
      <p>
        <span
          id="status-indicator"
          class="status-indicator status-loading"
        ></span>
        <span id="status-text">Loading test environment...</span>
      </p>
      <p>
        The test runner provides multiple test modes including unit tests,
        benchmark comparisons, and memory usage analysis. Use the different
        buttons to run specific test categories.
      </p>
    </div>

    <div id="test-container">
      <div class="loading-message">
        <p>üîÑ Setting up test environment...</p>
        <p>Please wait while we load the DOMOptimizer and test dependencies.</p>
      </div>
    </div>

    <div class="footer">
      <p>
        <strong>YouTube Theater Mode Extension</strong><br />
        DOMOptimizer Component Tests<br />
        <em>DOM Operations Performance & Optimization</em>
      </p>
    </div>

    <script src="./run-dom-optimizer-tests.js"></script>

    <script>
      // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞Áî®„ÅÆ„Éò„É´„Éë„ÉºÈñ¢Êï∞
      function updateStatus(status, text) {
        const indicator = document.getElementById("status-indicator");
        const statusText = document.getElementById("status-text");

        if (indicator && statusText) {
          indicator.className = `status-indicator status-${status}`;
          statusText.textContent = text;
        }
      }

      // ÂàùÊúüÂåñÂÆå‰∫Ü„ÇíÁõ£Ë¶ñ
      let checkInterval = setInterval(() => {
        if (
          typeof DOMOptimizer !== "undefined" &&
          typeof runDOMOptimizerTests !== "undefined"
        ) {
          updateStatus(
            "ready",
            'Test environment ready! Click "Run Tests" to begin.'
          );
          clearInterval(checkInterval);

          // „É≠„Éº„Éá„Ç£„É≥„Ç∞„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂâäÈô§
          const testContainer = document.getElementById("test-container");
          const loadingMessage =
            testContainer.querySelector(".loading-message");
          if (loadingMessage) {
            loadingMessage.remove();
          }
        }
      }, 100);

      // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
      setTimeout(() => {
        if (
          typeof DOMOptimizer === "undefined" ||
          typeof runDOMOptimizerTests === "undefined"
        ) {
          updateStatus(
            "error",
            "Failed to load test environment. Please check console for errors."
          );
          clearInterval(checkInterval);

          const testContainer = document.getElementById("test-container");
          testContainer.innerHTML = `
                    <div class="info-section" style="border-left: 4px solid #dc3545;">
                        <h3 style="color: #dc3545;">‚ùå Test Environment Setup Failed</h3>
                        <p>
                            The test environment could not be initialized. This may be due to:
                        </p>
                        <ul>
                            <li>Missing or incorrect file paths</li>
                            <li>JavaScript loading errors</li>
                            <li>Browser security restrictions</li>
                        </ul>
                        <p>
                            Please check the browser console for detailed error messages and ensure 
                            all required files are present in the correct locations.
                        </p>
                    </div>
                `;
        }
      }, 5000);

      // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
      window.addEventListener("error", (event) => {
        console.error("Global error in test page:", event.error);
        updateStatus(
          "error",
          "Error occurred during test setup. Check console for details."
        );
      });

      // Promise rejection „Éè„É≥„Éâ„É™„É≥„Ç∞
      window.addEventListener("unhandledrejection", (event) => {
        console.error(
          "Unhandled promise rejection in test page:",
          event.reason
        );
        updateStatus(
          "error",
          "Promise rejection occurred. Check console for details."
        );
      });
    </script>
  </body>
</html>
