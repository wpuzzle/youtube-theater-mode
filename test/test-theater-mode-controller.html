<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TheaterModeController テスト</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      #results {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        margin-top: 20px;
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 500px;
        overflow-y: auto;
      }
      .success {
        color: #2e7d32;
      }
      .error {
        color: #c62828;
      }
    </style>
  </head>
  <body>
    <h1>TheaterModeController テスト</h1>
    <p>このページは TheaterModeController クラスの単体テストを実行します。</p>
    <p>テスト結果はコンソールに出力されます。</p>

    <div id="results">テスト実行中...</div>

    <!-- 依存ライブラリ -->
    <script src="../infrastructure/logger.js"></script>
    <script src="../infrastructure/error-handler.js"></script>
    <script src="../infrastructure/state-store.js"></script>
    <script src="../infrastructure/element-manager.js"></script>
    <script src="../infrastructure/overlay-manager.js"></script>

    <!-- テスト対象 -->
    <script src="../theater-mode-controller.js"></script>

    <!-- テストスクリプト -->
    <script src="./test-theater-mode-controller.js"></script>

    <script>
      // コンソール出力をキャプチャしてページに表示
      const resultsDiv = document.getElementById("results");
      const originalConsole = {
        log: console.log,
        error: console.error,
        warn: console.warn,
        assert: console.assert,
      };

      let testOutput = "";

      console.log = function (...args) {
        originalConsole.log(...args);
        testOutput += args.join(" ") + "\n";
        resultsDiv.textContent = testOutput;
      };

      console.error = function (...args) {
        originalConsole.error(...args);
        testOutput += "❌ ERROR: " + args.join(" ") + "\n";
        resultsDiv.textContent = testOutput;
        resultsDiv.classList.add("error");
      };

      console.warn = function (...args) {
        originalConsole.warn(...args);
        testOutput += "⚠️ WARNING: " + args.join(" ") + "\n";
        resultsDiv.textContent = testOutput;
      };

      console.assert = function (condition, ...args) {
        if (!condition) {
          originalConsole.assert(condition, ...args);
          testOutput += "❌ ASSERTION FAILED: " + args.join(" ") + "\n";
          resultsDiv.textContent = testOutput;
          resultsDiv.classList.add("error");
        }
      };

      // テスト完了時の処理
      window.addEventListener("load", function () {
        setTimeout(function () {
          if (!testOutput.includes("FAILED") && !testOutput.includes("ERROR")) {
            resultsDiv.classList.add("success");
            testOutput += "\n✅ All tests completed successfully!";
            resultsDiv.textContent = testOutput;
          }
        }, 1000);
      });
    </script>
  </body>
</html>
